<!doctype html>
<html lang="en-CA">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Premium Supply — Product</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <input class="toggle" type="checkbox" id="catDrawerToggle">

  <!-- Topbar -->
  <div class="topbar">
    <div class="container topbar__inner">
      <span class="topbar__badge"><i class="fa-solid fa-maple-leaf"></i> 100% Canadian</span>
      <p class="topbar__text">Product</p>
      <a class="topbar__link" href="cart.html">Cart</a>
    </div>
  </div>

  <!-- Header -->
  <header class="header">
    <div class="container header__inner">
      <label class="icon-btn" for="catDrawerToggle" aria-label="Open categories"><i class="fa-solid fa-bars"></i></label>

      <a class="brand" href="products.html" aria-label="Premium Supply home">
        <img class="brand__logo-img" src="assets/brand/logo-planet.png" alt="Premium Supply">
        <span class="brand__text">
          <span class="brand__name">Premium Supply</span>
          <span class="brand__tag">Product</span>
        </span>
      </a>

      <div class="header__right">
        <a class="icon-btn" href="products.html" aria-label="Search"><i class="fa-solid fa-magnifying-glass"></i></a>

        <a class="icon-btn cart-btn" href="cart.html" aria-label="Cart">
          <i class="fa-solid fa-bag-shopping"></i>
          <span class="cart-badge js-cart-count">0</span>
        </a>
      </div>
    </div>
  </header>

  <!-- Drawer -->
  <label for="catDrawerToggle" class="drawer-backdrop" aria-hidden="true"></label>
  <aside class="drawer" aria-label="Shop by category">
    <div class="drawer__head">
      <div class="drawer__title"><i class="fa-solid fa-list"></i> Shop by category</div>
      <label class="icon-btn" for="catDrawerToggle" aria-label="Close"><i class="fa-solid fa-xmark"></i></label>
    </div>

    <nav class="cat-nav">
      <a class="cat-link" href="products.html">All Products</a>
      <div class="cat-sep"></div>
      <a class="cat-link" href="category.html?c=Flower">Flower</a>
      <a class="cat-link" href="category.html?c=Concentrates">Concentrates</a>
      <a class="cat-link" href="category.html?c=Edibles">Edibles</a>
      <a class="cat-link" href="category.html?c=Vapes">Vapes</a>
      <a class="cat-link" href="category.html?c=CBD">CBD</a>
      <a class="cat-link" href="category.html?c=Male%20Enhancers">Male Enhancers</a>
      <div class="cat-sep"></div>
      <a class="cat-link" href="cart.html">Cart</a>
      <a class="cat-link" href="checkout.html">Checkout</a>
    </nav>
  </aside>

  <main class="section">
    <div class="container">
      <div class="product-hero">
        <!-- Left: Image -->
        <div class="product-media-sticky">
          <div class="card" id="mediaCard">
            <div class="media-square" id="mediaSquare">
              <div class="media-placeholder" aria-hidden="true"></div>
            </div>
          </div>
        </div>

        <!-- Right: Details -->
        <section class="card" id="detailsCard">
          <p class="muted" style="margin:0 0 10px;">
            <a href="products.html" style="text-decoration:underline; text-underline-offset:3px; font-weight:950;">← Back to All Products</a>
            <span class="muted"> • </span>
            <a href="#" id="backToCategory" style="text-decoration:underline; text-underline-offset:3px; font-weight:950; display:none;">Back to category</a>
          </p>

          <h1 class="block__title" id="name" style="margin:0;">Loading…</h1>

          <div class="pill-row" style="margin-top:10px;">
            <span class="pill pill--tier" id="tier">—</span>
            <span class="pill pill--tag" id="category">—</span>
            <span class="pill" id="typePill"><i class="fa-solid fa-wand-magic-sparkles"></i> <span id="type">—</span></span>
          </div>

          <div class="rating" style="margin-top:10px;">
            <div class="stars" id="stars"></div>
            <div class="reviews"><span id="reviews">0</span> reviews</div>
          </div>

          <div class="price" style="font-size:1.15rem; margin-top:6px;">
            <span id="price">$0.00</span> <span class="muted">CAD</span>
          </div>

          <p class="muted" id="desc" style="margin:10px 0 0;">
            Premium-grade selection with a clean space-store vibe. (Replace this text if you want a custom description per item.)
          </p>

          <div class="buy-row" style="margin-top:12px;">
            <div class="qty">
              <span>Quantity</span>
              <div class="qty-stepper">
                <button class="qty-btn" id="minus" type="button">−</button>
                <input class="qty-input" id="qty" type="number" min="1" value="1">
                <button class="qty-btn" id="plus" type="button">+</button>
              </div>
            </div>

            <button class="btn btn--solid btn--full" id="buyBtn" type="button">
              Buy
            </button>
          </div>

          <div class="hr"></div>

          <div class="card" style="padding:12px;">
            <strong>Store notes</strong>
            <ul class="muted" style="margin:8px 0 0; padding-left:18px;">
              <li>Minimum order: <strong>$75 CAD</strong></li>
              <li>Free shipping: <strong>$250+ CAD</strong></li>
              <li>Proudly Canadian</li>
            </ul>
          </div>
        </section>
      </div>
    </div>
  </main>

  <div class="toast" id="toast" role="status" aria-live="polite">
    <span id="toastText">Added to cart.</span>
    <a href="cart.html">View cart</a>
  </div>

  <script>
    const PS = { currency:"CAD", cartKey:"ps_cart_v1" };
    const $ = (s, el=document) => el.querySelector(s);
    const $$ = (s, el=document) => Array.from(el.querySelectorAll(s));
    const money = (n) => new Intl.NumberFormat("en-CA",{style:"currency",currency:PS.currency}).format(n);

    function getParam(name){ return new URLSearchParams(location.search).get(name); }

    function toStarHTML(rating){
      const r = Math.round((Number(rating)||0) * 2) / 2;
      const full = Math.floor(r);
      const half = (r - full) >= 0.5;
      let html = "";
      for(let i=0;i<full;i++) html += '<i class="fa-solid fa-star"></i>';
      if(half) html += '<i class="fa-solid fa-star-half-stroke"></i>';
      const empty = 5 - full - (half ? 1 : 0);
      for(let i=0;i<empty;i++) html += '<i class="fa-regular fa-star"></i>';
      return html;
    }

    function readCart(){ try { return JSON.parse(localStorage.getItem(PS.cartKey) || "{}"); } catch { return {}; } }
    function writeCart(cart){ localStorage.setItem(PS.cartKey, JSON.stringify(cart)); }
    function cartCount(cart){ return Object.values(cart).reduce((s,i)=> s + (i.qty||0), 0); }
    function updateBadges(){
      const count = cartCount(readCart());
      $$(".js-cart-count").forEach(el => el.textContent = String(count));
    }
    function showToast(msg){
      $("#toastText").textContent = msg;
      $("#toast").classList.add("toast--show");
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=> $("#toast").classList.remove("toast--show"), 2200);
    }

    async function loadCatalog(){
      const res = await fetch("catalog.json", { cache:"no-store" });
      if(!res.ok) throw new Error("catalog.json missing");
      return await res.json();
    }

    (async function init(){
      updateBadges();

      const id = getParam("id");
      if(!id){
        $("#detailsCard").innerHTML = `<strong>Missing product ID.</strong><p class="muted">Open from the product list.</p>`;
        return;
      }

      const catalog = await loadCatalog();
      const p = catalog.find(x => x.id === id);

      if(!p){
        $("#detailsCard").innerHTML = `<strong>Product not found.</strong><p class="muted">This item may have been removed from catalog.json.</p>`;
        return;
      }

      document.title = `Premium Supply — ${p.name}`;

      $("#name").textContent = p.name;
      $("#tier").textContent = p.tier || "Premium";
      $("#category").textContent = p.category || "Category";
      $("#type").textContent = p.type || "—";
      $("#reviews").textContent = String(Number(p.reviews||0));
      $("#stars").innerHTML = toStarHTML(p.rating);
      $("#price").textContent = money(Number(p.price||0));

      // back to category link
      if(p.category){
        const a = $("#backToCategory");
        a.style.display = "inline";
        a.href = `category.html?c=${encodeURIComponent(p.category)}`;
        a.textContent = `Back to ${p.category}`;
      }

      // image
      if(p.image){
        $("#mediaSquare").innerHTML = `<img src="${p.image}" alt="${p.name}">`;
      }

      // qty controls
      const qtyInput = $("#qty");
      $("#plus").onclick = () => qtyInput.value = String(Math.max(1, (Number(qtyInput.value)||1) + 1));
      $("#minus").onclick = () => qtyInput.value = String(Math.max(1, (Number(qtyInput.value)||1) - 1));

      $("#buyBtn").onclick = () => {
        const qty = Math.max(1, Number(qtyInput.value || 1));
        const cart = readCart();
        if(cart[p.id]) cart[p.id].qty += qty;
        else cart[p.id] = { ...p, qty };
        writeCart(cart);
        updateBadges();
        showToast(`Added ${qty} × ${p.name}`);
      };
    })().catch(err => {
      console.error(err);
      $("#detailsCard").innerHTML = `<strong>Could not load product.</strong><p class="muted">Make sure catalog.json exists and you are viewing via GitHub Pages.</p>`;
    });
  </script>
</body>
</html>